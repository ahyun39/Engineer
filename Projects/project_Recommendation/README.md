# 공공데이터 기반 로컬 장소 검색(Semantic Search) 시스템

<br>

## 1. 프로젝트 개요

공공데이터로 제공되는 약 270만 건의 전국 상권 정보를 활용하여 사용자의 자연어 질의에 따라 최적의 매장을 추천하는 검색 시스템을 구축한 프로젝트입니다.

단순히 키워드가 일치하는 장소를 찾는 것뿐만 아니라 문맥을 이해하는 시맨틱 검색을 구현하고, 발견된 검색 품질 저하 문제를 구조적 필터링과 가중치 기반 Reranking으로 해결하고자 했습니다.

<br>

## 2. 사용 기술 및 데이터 셋

- Data: 소상공인시장진흥공단 상가(상권)정보 (약 2,695,924건)

- Models:
    - Bi-Encoder: paraphrase-multilingual-MiniLM-L12-v2 → KR-SBERT-V40K-klueNLI-augSTS (한국어 특화 모델로 개선)
    - Cross-Encoder: cross-encoder/ms-marco-MiniLM-L-6-v2 (리랭킹용)

- Library: Pandas, PyTorch, FAISS, SentenceTransformers

<br>

## 3. 사용 데이터

### 주요 컬럼
|컬럼명|설명|비고|
|----|---|---|
|상호명|가게 이름|검색 및 리랭킹 핵심 키워드|
|상권업종대분류명|음식/소매/서비스 등||
|상권업종소분류명|세부 업종(예:횟집, 카페, 호텔/리조트 등)|구조적 필터링 및 가중치 부여 기준|
|시도명/시군구명|광역 및 기초 지자체 지역명|검색 범위 제한 기준|
|도로명주소|매장의 상세 위치 정보|사용자에게 제공될 최종 정보|

### 검색 문서(Document) 구성

- 1차(문장형)
    ```
    가게 이름은 {상호명}입니다.
    {시도명} {시군구명}에 위치한 {상권업종소분류명} 매장입니다.
    주소는 {도로명주소}입니다.
    ```
    와 같이 자연어 형태로 구성.

- 2차(태그형)
    ```
    [업종] {상권업종소분류명}
    [지역] {시도명} {시군구명}
    [가게명] {상호명}
    [주소] {도로명주소}
    ```
    조사와 어미를 제거하고 [업종], [지역], [가게명] 등 핵심 메타데이터를 태그 형식으로 구조화하여 임베딩 노이즈를 최소화

<br>

## 4. 구현 프로세스

**[Phase 1] Baseline: Bi-Encoder 기반 시맨틱 검색**
- 문서화: 상호명, 업종 정보, 주소를 자연어 문장으로 결합하여 임베딩 데이터셋 생성
- 문제점: "강남구 카페" 검색 시 강릉의 숙박시설이 노출되는 등, 특정 지역/업종 키워드에 대한 검색 정확도 저하 확인 (Recall@K 0.0180)
- 시도: Cross-Encoder 리랭킹을 도입했으나, 후보군 자체가 잘못 추출되어 성능 개선의 한계를 확인

**[Phase 2] 검색 프로세스 재설계**
- Phase1 문제점 해결: 규칙 기반 쿼리 파싱 로직을 추가하여 지역명과 업종명을 정규화 추출
- 구조적 필터링: 벡터 검색 전, 파싱된 업종/지역 조건을 만족하는 데이터로 검색 범위를 사전에 제한하여 노이즈 제거
- 결과: Precision@K 1.0 (100%) 달성
- 문제점: 쿼리에서 일치하는 업종이 일치하지 않는 업종보다 낮은 랭킹으로 노출되는 경향이 발생
    - "호텔" 검색 시 업종에 "모텔"이 포함된 매장이 실제 "호텔/리조트"보다 상위에 랭크되는 결과 발생

**[Phase 3] 가중치 적용**
- Phase2 문제점 해결: 사용자의 핵심 의도를 sub_intent로 추출하여 실제 업종 분류와 일치할 경우 유사도 점수에 가중치 부여
- 결과: 단순 텍스트 유사도를 넘어 사용자 의도와 업종 정합성이 일치하는 매장을 최상단에 노출 성공


<br>

## 5. 시스템 구조

```scss
User Query (ex: "경남 호텔 추천")
   ↓
Query Parsing (지역: 경상남도 / 의도: 호텔 추출)
   ↓
Rule-based Filtering (경상남도 + 숙박 업종 데이터만 선별)
   ↓
Semantic Search (KR-SBERT Embedding + FAISS 유사도 검색)
   ↓
Weighting Logic (업종이 '호텔/리조트'인 경우 Score +0.1)
   ↓
Result (정렬된 최적의 매장 정보 리스트)
```

<br>

## 6. 성능 지표 결과

- Recall@K : 정답이 상위 K개의 검색 결과 안에 들어있는 비율
- Precision@K : 검색한 상위 K개 중에서 실제 정답이 들어있는 비율
- MRR : 첫 정답의 평균 순위(정답이 얼마나 상위에 빠르게 뜨는지)

<br>

|모델 단계|Recall@10|MRR|Precision@K5|주요 성과|
|-------|---------|---------|---------|---------|
|(Phase1) semantic search|0.0180|0.004222|-|베이스라인 및 한계 확인|
|(Phase1) semantic search + reranker|0.0180|0.009619|-|Reranker 단독 도입 한계|
|(Phase2) KR-SBERT + Filter|0.0833|1.0000|1.0000|지역/업종 정확도 확보|
|(Phase3) + Weight|-|-|1.0000|의도 부합 매장 우선순위 최적화|

<br>

## 7. 프로젝트 수행 결과

- 성과: 대규모 공공데이터에서 단순 임베딩 유사도의 한계를 구조적 필터링과 도메인 지식 기반 가중치로 보완하여 검색 성능 개선

- 한계: 감성/취향(예: 분위기 좋은, 데이트용 등), 편의시설(주차 가능 여부, 24시간 영업 여부 등) 기반 쿼리와 리뷰/평점 기반 조건을 고려하지 않았다. (활용 데이터에 본 정보가 존재하지 X)

- 개선 방향: 고려하지 않은 조건의 내용이 있는 데이터를 활용하게 될 경우, 좀 더 복잡한 쿼리에 대한 결과를 출력할 수 있게 할 수 있을 것 같다.
